version: "3"

services:
  traefik:
    # The official v2 Traefik docker image
    image: traefik:v2.10
    ports:
      # The HTTP port
      - "80:80"
      # The Web UI (enabled by --api.insecure=true)
      - "8080:8080"
      # - "443:443"
    volumes:
      # So that Traefik can listen to the Docker events
      - /var/run/docker.sock:/var/run/docker.sock
      - ./traefik.yaml:/traefik.yaml # mount traefik config file
      - ./file-conf.yaml:/file-conf.yaml # mount file provider config file
  whoami:
    image: "traefik/whoami"
    # command:
    # It tells whoami to start listening on 2001 instead of 80
    # - --port=2001
    # - --name=iamfoo
    # WARN: a custom port will break traefik's default request-forwarding
    # ports:
    #   - "2001:2001"

    labels:
      # https://doc.traefik.io/traefik/routing/routers/#rule
      - "traefik.enable=true"
      # - "traefik.http.routers.whoami.rule=Host(`test.thekevinwang.com`)"
      - "traefik.http.routers.whoami.rule=Path(`/test`)"
      # - "traefik.http.routers.whoami.entrypoints=web"

networks:
  web:
    external: true
